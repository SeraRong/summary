
执行环境及作用域
=========

###一、执行环境

**执行环境**定义了变量或函数有权访问的其他数据，决定了各自的行为。每个执行环境都有一个与之关联的变量对象，环境中定义的所有变量和函数都保存在这个对象中。

**全局执行环境**是最外围的一个执行环境。根据ECMAScript实现所在的宿主环境不同，表示执行环境的对象也不一样。在**Web浏览器中，全局执行环境被认为是window对象**，因此所有全局变量和函数都是作为window对象的属性和方法创建的。某个执行环境中的所有代码执行完毕，该环境被销毁，保存在其中的所有变量和函数定义也随之销毁。全局执行环境直到应用程序退出或关闭网页/浏览器时才会被销毁。

**每个函数在被调用时都会创建自己的执行环境**。当执行流进入一个函数时，函数的环境会被推入一个环境栈中。函数执行之后，栈将其环境弹出，把控制权返回给之前的执行环境。

###二、作用域链

当代码在一个环境中执行时，会创建由变量对象构成的一个作用域链。作用域的前端始终是当前执行代码所在环境的变量对象。如果环境是函数，则将其活动对象作为变量对象。**活动对象最开始时只包含一个变量，即arguments对象**（全局环境中不存在这个对象）。作用域的下一个变量来自包含环境，在下一个变量来自下一个包含环境。

**【注】** 内部环境可以通过作用域链访问所有的外部环境，而外部环境不能访问内部环境中的任何变量和函数。

###三、没有块级作用域
JavaScript没有块级作用域。
```javascript
if (true) {
    var color = "blue";
}

alert(color); //blue
```
```javascript
for (var i = 0; i < 10; i++) {
    doSomeThing(i);
}

alert(i); //10
```
- 在使用var申明变量时，将变量自动添加到距离最近的可用环境中。对于函数而言，最近的可用环境就是函数的局部环境。

- 变量在未经申明的情况下被初始化，变量自动添加到全局环境。
