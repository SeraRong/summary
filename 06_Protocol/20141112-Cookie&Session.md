Cookie 与 Session 的区别
=====================

###1、cookie机制
**Cookies**是服务器在**本地机器上存储**的小段文本并**随每一个请求发送至同一个服务器**。**IETF RFC 2965 HTTP State Management Mechanism** 是**通用cookie规范**。**网络服务器**用**HTTP头**向**客户端发送cookies**，在**客户终端**，**浏览器解析**这些**cookies**并**将它们保存为一个本地文件**，它会**自动将同一服务器的任何请求附上这些cookies**。

具体来说**cookie机制**采用的是在**客户端保持会话状态的方案**。它是在用户端的会话状态的存贮机制，他需要用户打开客户端的cookie支持。**cookie**的**作用**就是为了**解决HTTP协议无状态的缺陷**所作的努力。

**正统的cookie分发**是**通过扩展HTTP协议来实现**的，**服务器**通过在**HTTP的响应头中加上一行特殊的指示**以提示**浏览器按照指示生成相应的cookie**。然而纯粹的客户端脚本如JavaScript也可以生成cookie。而cookie的使用是由浏览器按照一定的原则在后台自动发送给服务器的。**浏览器检查所有存储的cookie**，如果**某个cookie所声明的作用范围大于等于将要请求的资源所在的位置**，则**把该cookie附在请求资源的HTTP请求头上发送给服务器**。

**cookie**的**内容**主要包括：**名字**，**值**，**过期时间**，**路径**和**域**。
- **路径**与**域**一起构成**cookie的作用范围**。
- 若**不设置过期时间**，则表示这个**cookie的生命期**为**浏览器会话期间**，关闭浏览器窗口，cookie就消失。这种**生命期为浏览器会话期的cookie**被称为**会话cookie**。若**设置了过期时间**，浏览器就会把**cookie保存到硬盘上**，关闭后再次打开浏览器，这些cookie仍然有效直到超过设定的过期时间。
	- **会话cookie**一般**不存储在硬盘上**而是**保存在内存里**，当然这种行为并不是规范规定的。
	- **存储在硬盘上的cookie**可以**在不同的浏览器进程间共享**，比如两个IE窗口。而对于**保存在内存里的cookie**，**不同的浏览器**有**不同的处理方式**。

而**session机制**采用的是一种**在服务器端保持状态的解决方案**。同时我们也看到，由于**采用服务器端保持状态的方案**在**客户端也需要保存一个标识**，所以**session机制可能**需要**借助于cookie机制**来达到**保存标识**的目的。而**session提供了方便管理全局变量的方式**。

**session**是**针对每一个用户**的，**变量的值保存在服务器上**，用一个**sessionID**来**区分**是哪个**用户session变量**,这个值是**通过用户的浏览器在访问的时候返回给服务器**，当客户**禁用cookie时**，这个值**也可能**设置为**由get来返回给服务器**。

就安全性来说：当你访问一个使用session 的站点，同时在自己机子上建立一个cookie，建议在服务器端的session机制更安全些，因为它不会任意读取客户存储的信息。

###2、session机制
**session机制**是一种**服务器端的机制**，服务器使用一种**类似于散列表的结构**（也可能就是使用散列表）来**保存信息**。

当程序需要为某个客户端的请求创建一个session时，服务器首先检查这个客户端的请求里是否已包含了一个session标识（称为session id），如果已包含则说明以前已经为此客户端创建过session，服务器就按照session id把这个session检索出来使用（检索不到，会新建一个），如果客户端请求不包含session id，则为此客户端创建一个session并且生成一个与此session相关联的session id，session id的值应该是一个既不会重复，又不容易被找到规律以仿造的字符串，这个session id将被在本次响应中返回给客户端保存。

**保存**这个**session id的方式**：
- 可以采用**cookie**，这样在交互过程中浏览器可以自动的按照规则把这个标识发挥给服务器。一般这个cookie的名字都是类似于SEEESIONID。但cookie可以被人为的禁止，则必须有其他机制以便在cookie被禁止时仍然能够把session id传递回服务器。
- 经常被使用的一种技术叫做**URL重写**，就是把session id直接附加在URL路径的后面。
- 还有一种技术叫做**表单隐藏字段**。就是服务器会自动修改表单，添加一个隐藏字段，以便在表单提交时能够把session id传递回服务器。



###3、Cookie 与 Session 区别
**Cookie与Session都能够进行会话跟踪**，但是完成的原理不太一样。普通状况下二者均能够满足需求，但有时分不能够运用Cookie，有时分不能够运用Session。

下面经过比拟阐明二者的特性以及适用的场所。

####3.1 存取方式的不同

**Cookie**

- **Cookie**中**只能**保管**ASCII字符串**，假如需求存取Unicode字符或者二进制数据，需求先进行编码。
- **Cookie**中也**不能直接存取Java对象**。若要存储略微复杂的信息，运用Cookie是比拟艰难的。

**Session**

- **Session**中能够**存取任何类型的数据**，包括而不限于String、Integer、List、Map等。
- **Session**中也**能够直接保管Java Bean乃至任何Java类，对象等**，运用起来十分便当。能够把Session看做是一个Java容器类。

####3.2 隐私策略的不同

- **Cookie**存储在客户端阅读器中，**对客户端是可见的**，客户端的一些程序可能会窥探、复制以至修正Cookie中的内容。
- **Session**存储在服务器上，**对客户端是透明的**，不存在敏感信息泄露的风险。

假如选用Cookie，比较好的方法是，敏感的信息如账号密码等尽量不要写到Cookie中。最好是像Google、Baidu那样将Cookie信息加密，提交到服务器后再进行解密，保证Cookie中的信息只要本人能读得懂。而假如选择Session就省事多了，反正是放在服务器上，Session里任何隐私都能够有效的保护。

####3.3 有效期上的不同

- 使用过Google的人都晓得，假如登录过Google，则Google的登录信息长期有效。用户不用每次访问都重新登录，Google会持久地记载该用户的登录信息。要到达这种效果，运用Cookie会是比较好的选择。只需要设置Cookie的过期时间属性为一个很大很大的数字。

- 由于Session依赖于名为JSESSIONID的Cookie，而Cookie JSESSIONID的过期时间默许为–1，只需关闭了阅读器该Session就会失效，因而**Session不能完成信息永世有效的效果**。运用URL地址重写也不能完成。而且假如设置Session的超时时间过长，服务器累计的Session就会越多，越容易招致内存溢出。

####3.4 服务器压力的不同

- **Session**是**保管在服务器端**的，**每个用户**都会**产生一个Session**。假如**并发访问**的用户十分多，会产生十分多的Session，**耗费大量的内存**。因而像Google、Baidu、Sina这样并发访问量极高的网站，是不太可能运用Session来追踪客户会话的。

- **Cookie保管在客户端**，**不占用服务器资源**。假如并发阅读的用户十分多，Cookie是很好的选择。关于Google、Baidu、Sina来说，Cookie或许是唯一的选择。

####3.5 浏览器支持的不同

**Cookie**是**需要客户端浏览器支持**的。假如客户端**禁用了Cookie**，或者**不支持Cookie**，则**会话跟踪会失效**。关于WAP上的应用，常规的Cookie就派不上用场了。

- 假如客户端浏览器**不支持Cookie**，需要**运用Session以及URL地址重写**。

**［注］** *一切的用到Session程序的URL都要进行URL地址重写，否则Session会话跟踪还会失效。*关于WAP应用来说，Session+URL地址重写或许是它唯一的选择。

- 假如客户端**支持Cookie**，则**Cookie**既能够**设为本浏览器窗口以及子窗口内有效**（把**过期时间**设为**–1**），也能够**设为一切阅读器窗口内有效**（把**过期时间**设为某个**大于0的整数**）。但**Session只能在本阅读器窗口以及其子窗口内有效**。假如两个浏览器窗口互不相干，它们将运用两个不同的Session。（IE8下不同窗口Session相干）

####3.6 跨域支持上的不同

**Cookie支持跨域名访问**，例如将domain属性设置为“.biaodianfu.com”，则以“.biaodianfu.com”为后缀的一切域名均能够访问该Cookie。跨域名Cookie如今被普遍用在网络中，例如Google、Baidu、Sina等。而**Session则不会支持跨域名访问**。**Session仅在他所在的域名内有效**。

仅运用Cookie或者仅运用Session可能完成不了理想的效果。这时应该尝试一下同时运用Cookie与Session。Cookie与Session的搭配运用在实践项目中会完成很多意想不到的效果。